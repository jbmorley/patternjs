<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>pattern.js</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css">
    <link id="theme" rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
    <script src="utilities.js"></script>
    <script>

        function onDocumentReady(callback) {
            document.addEventListener('DOMContentLoaded', callback, false);
        }

        function onResize(element, callback) {
                var parent = element.parentElement;
                var resizeCallback = function() {
                    callback(element, parent.clientWidth, parent.clientHeight);
                }
                window.addEventListener('resize', resizeCallback, false);
                resizeCallback();
        }

        function slider(key, configuration, callback) {

            var change = function(event) {
                callback(key, Number(event.target.value));
            }

            var div = document.createElement('div');
            div.classList.add("control");

            var label = document.createElement('label');
            label.innerHTML = configuration.title;
            div.appendChild(label);

            var input = document.createElement('input');
            input.type = "range";
            input.value = configuration.default;
            input.min = configuration.min;
            input.max = configuration.max;
            if (configuration.step !== undefined) {
                input.step = configuration.step;
            }
            input.classList.add("slider");
            input.addEventListener('change', change);
            input.addEventListener('input', change);
            input.addEventListener('keyup', change);
            div.appendChild(input);

            return div;
        }

        function initialize(id, height, renderer, parameters) {
            Utilities.onDocumentReady(function() {

                var options = {}

                var container = document.getElementById(id);
                var canvas = document.createElement('canvas');
                canvas.classList.add('pattern');
                container.appendChild(canvas);

                var optionDiv = document.createElement('div');
                optionDiv.classList.add('content');
                container.appendChild(optionDiv);

                for (var parameter in parameters) {
                    options[parameter] = parameters[parameter].default;
                    optionDiv.appendChild(slider(parameter,
                                                 parameters[parameter],
                                                 function(key, value) {
                                                     options[key] = value;
                                                     renderer(canvas, options);
                                                 }));
                }

                var buttonDiv = document.createElement('div');
                buttonDiv.classList.add('content');
                buttonDiv.classList.add('meta');
                container.appendChild(buttonDiv);

                var rendererWithOptions = function(canvas) {
                    renderer(canvas, options);
                }

                buttonDiv.appendChild(Utilities.downloadButton(id,
                                                               window.screen.width * window.devicePixelRatio,
                                                               window.screen.height * window.devicePixelRatio,
                                                               "Download Desktop",
                                                               rendererWithOptions));
                buttonDiv.appendChild(Utilities.downloadButton(id,
                                                               600 * window.devicePixelRatio,
                                                               400 * window.devicePixelRatio,
                                                               "Download Sample",
                                                               rendererWithOptions));

                buttonDiv.appendChild(Utilities.button("Download SVG", function(event) {

                    var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                    svg.setAttribute('style', 'border: 1px solid black');
                    svg.setAttribute('width', '400');
                    svg.setAttribute('height', '450');
                    svg.setAttributeNS("http://www.w3.org/2000/xmlns/", "xmlns:xlink", "http://www.w3.org/1999/xlink");

                    var path1 = document.createElementNS("http://www.w3.org/2000/svg", 'path');
                    path1.setAttribute('d', 'M 100 350 l 150 -300');
                    path1.setAttribute('stroke', 'red');
                    path1.setAttribute('stroke-width', '3');
                    path1.setAttribute('fill', 'none');
                    svg.appendChild(path1);

                    var path2 = document.createElementNS("http://www.w3.org/2000/svg", 'path');
                    path2.setAttribute('d', 'M 250 50 l 150 300');
                    path2.setAttribute('stroke', 'red');
                    path2.setAttribute('stroke-width', '3');
                    path2.setAttribute('fill', 'none');
                    svg.appendChild(path2);

                    var path3 = document.createElementNS("http://www.w3.org/2000/svg", 'path');
                    path3.setAttribute('d', 'M 175 200 l 150 0');
                    path3.setAttribute('stroke', 'green');
                    path3.setAttribute('stroke-width', '3');
                    path3.setAttribute('fill', 'none');
                    svg.appendChild(path3);

                    var path4 = document.createElementNS("http://www.w3.org/2000/svg", 'path');
                    path4.setAttribute('d', 'M 100 350 q 150 -300 300 0');
                    path4.setAttribute('stroke', 'blue');
                    path4.setAttribute('stroke-width', '5');
                    path4.setAttribute('fill', 'none');
                    svg.appendChild(path4);

                    var serializer = new XMLSerializer();
                    var output = serializer.serializeToString(svg);

                    var a = document.createElement('a');
                    a.href = "data:text/svg;charset=UTF-8," + output;
                    a.download = 'pattern.svg';
                    if (typeof MouseEvent === "function") {
                        event = new MouseEvent("click", {
                            view: window,
                            bubbles: true,
                            cancelable: true,
                            ctrlKey: false,
                            altKey: false,
                            shiftKey: false,
                            metaKey: false,
                            button: 0,
                            buttons: 1,
                        });
                        a.dispatchEvent(event);
                    } else if (a.fireEvent) {
                        a.fireEvent("onclick");
                    }
                }));
                
                renderer(canvas, options);
                onResize(canvas, function(canvas, parentWidth, parentHeight) {
                    canvas.width = parentWidth * window.devicePixelRatio;
                    canvas.height = height * window.devicePixelRatio;
                    canvas.style.width = parentWidth + 'px';
                    canvas.style.height = height + 'px';
                    renderer(canvas, options);
                });
            });
        }

    </script>
</head>
<body>

<h1>pattern.js</h1>

<h2>麻の葉, Asa no ha</h2>
<div id="asanoha" class="pattern-container"></div>
<script type="text/javascript">
    initialize('asanoha', 300, function(canvas, options) {
        Pattern.asanoha({
            canvas: canvas,
            style: Pattern.styles.darkBlue,
            size: options.size,
            lineDrawer: Pattern.drawers.line(options.lineWidth),
        });
    }, {lineWidth: {title: 'Line Width', default: 2, min: 1, max: 20},
        size: {title: 'Size', default: 100, min: 1, max: 200}});
</script>
<pre><code class="javascript">Pattern.asanoha({
    canvas: canvas,
    style: Pattern.styles.darkBlue,
    size: 100,
    lineDrawer: Pattern.drawers.line(2),
});</code></pre>

<div id="asanoha-dots" class="pattern-container"></div>
<script type="text/javascript">
    initialize('asanoha-dots', 300, function(canvas, options) {
        Pattern.asanoha({
            canvas: canvas,
            style: Pattern.styles.darkRed,
            size: options.size,
            lineDrawer: Pattern.drawers.dottedLine(2, 8),
        });
    }, {size: {title: 'Size', default: 100, min: 1, max: 200}});
</script>
<pre><code class="javascript">Pattern.asanoha({
    canvas: canvas,
    style: Pattern.styles.darkRed,
    size: 100,
    lineDrawer: Pattern.drawers.dottedLine(2, 8),
});</code></pre>

<h2>七宝, Shippou</h2>
<div id="circles" class="pattern-container"></div>
<script type="text/javascript">
    initialize('circles', 300, function(canvas, options) {
        Pattern.shippou({
            canvas: canvas,
            style: Pattern.styles.purple,
            lineWidth: options.lineWidth,
            radius: options.radius,
        });
    }, {lineWidth: {title: 'Line Width', default: 4, min: 1, max: 20},
        radius: {title: 'Radius', default: 40, min: 1, max: 100}});
</script>
<pre><code class="javascript">Pattern.shippou({
    canvas: canvas,
    style: Pattern.styles.purple,
    lineWidth: 4,
    radius: 40,
});</code></pre>

<h2>青海波, Seigaiha</h2>

<div id="waves" class="pattern-container"></div>
<script type="text/javascript">
    initialize('waves', 300, function(canvas, options) {
        Pattern.seigaiha({
            canvas: canvas,
            style: Pattern.styles.monochrome,
            lineWidth: options.lineWidth,
            radius: options.radius,
            lineSpacing: options.lineSpacing,
            count: options.count,
            alternating: false,
        });
    }, {lineWidth: {title: 'Line Width', default: 3, min: 1, max: 20},
        count: {title: 'Line Count', default: 5, min: 2, max: 20},
        lineSpacing: {title: 'Line Spacing', default: 10, min: 1, max: 20},
        radius: {title: 'Radius', default: 55, min: 1, max: 200}});
</script>
<pre><code class="javascript">Pattern.seigaiha({
    canvas: canvas,
    style: Pattern.styles.monochrome,
    lineWidth: 3,
    radius: 55,
    lineSpacing: 10,
    count: 5,
    alternating: false,
});</code></pre>

<div id="waves-light" class="pattern-container"></div>
<script type="text/javascript">
    initialize('waves-light', 300, function(canvas, options) {
        Pattern.seigaiha({
            canvas: canvas, 
            style: Pattern.styles.sky,
            lineWidth: options.lineWidth,
            radius: options.radius,
            lineSpacing: options.lineSpacing, 
            count: options.count,
            alternating: false,
        });
    }, {lineWidth: {title: 'Line Width', default: 2, min: 1, max: 20},
        count: {title: 'Line Count', default: 11, min: 2, max: 20},
        lineSpacing: {title: 'Line Spacing', default: 7, min: 1, max: 20},
        radius: {title: 'Radius', default: 80, min: 1, max: 200}});
</script>
<pre><code class="javascript">Pattern.seigaiha({
    canvas: canvas, 
    style: Pattern.styles.sky,
    lineWidth: 2, 
    radius: 80,
    lineSpacing: 7, 
    count: 11,
    alternating: false,
});</code></pre>

<div id="waves-inverted" class="pattern-container"></div>
<script type="text/javascript">
    initialize('waves-inverted', 300, function(canvas, options) {
        Pattern.seigaiha({
            canvas: canvas,
            style: Pattern.styles.blues,
            lineWidth: options.lineWidth,
            radius: options.radius,
            lineSpacing: options.lineSpacing,
            count: options.count,
            alternating: true
        });
    }, {lineWidth: {title: 'Line Width', default: 3, min: 1, max: 20},
        count: {title: 'Line Count', default: 5, min: 2, max: 20},
        lineSpacing: {title: 'Line Spacing', default: 8, min: 1, max: 20},
        radius: {title: 'Radius', default: 44, min: 1, max: 200}});
</script>
<pre><code class="javascript">Pattern.seigaiha({
    canvas: canvas,
    style: Pattern.styles.blues,
    lineWidth: 3,
    radius: 44,
    lineSpacing: 8,
    count: 5,
    alternating: true
});</code></pre>

<h2>紗綾形, Sayagata</h2>

<div id="sayagata" class="pattern-container"></div>
<script type="text/javascript">    
    initialize('sayagata', 300, function(canvas, options) {
        Pattern.sayagata({
            canvas: canvas,
            style: Pattern.styles.purples,
            featureLength: options.featureLength,
            angle: options.angle,
            lineWidth: options.lineWidth,
        });
    }, {lineWidth: {title: 'Line Width', default: 1, min: 1, max: 10},
        featureLength: {title: 'Feature Length', default: 12, min: 1, max: 75},
        angle: {title: 'Angle', default: Math.PI / 2.5, min: Math.PI / 30, max: Math.PI / 2, step: Math.PI / 60}});
</script>
<pre><code class="javascript">Pattern.sayagata({
    canvas: canvas,
    style: Pattern.styles.purples,
    featureLength: 10,
    angle: Math.PI / 3,
    lineWidth: 1,
});</code></pre>

<h2>Unknown</h2>

<div id="unknown" class="pattern-container"></div>
<script type="text/javascript">
    initialize('unknown', 300, function(canvas, options) {
        Pattern.unknown({
            canvas: canvas,
            style: Pattern.styles.monochrome,
        });
    });
</script>
<pre><code class="javascript">Pattern.unknown({
    canvas: canvas,
    style: Pattern.styles.monochrome,
});</code></pre>

<p class="copyright">
    Copyright &copy; Jason Barrie Morley 2019
</p>

<script src="pattern.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>