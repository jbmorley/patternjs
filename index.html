<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>pattern.js</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css">
    <link id="theme" rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>

    <script src="utilities.js"></script>
    <script>

        // https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript#2117523
        function uuidv4() {
            return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c => (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16));
        }

        function onResize(element, callback) {
            var parent = element.parentElement;
            var resizeCallback = function() {
                callback(element, parent.clientWidth, parent.clientHeight);
            }
            window.addEventListener('resize', resizeCallback, false);
            resizeCallback();
            return resizeCallback;
        }

        function slider(key, configuration, callback) {

            var change = function(event) {
                callback(key, Number(event.target.value));
            }

            var div = document.createElement('div');
            div.classList.add("control");

            var label = document.createElement('label');
            label.innerHTML = configuration.title;
            div.appendChild(label);

            var input = document.createElement('input');
            input.type = "range";
            input.value = configuration.default;
            input.min = configuration.min;
            input.max = configuration.max;
            if (configuration.step !== undefined) {
                input.step = configuration.step;
            }
            input.classList.add("slider");
            input.addEventListener('change', change);
            input.addEventListener('input', change);
            input.addEventListener('keyup', change);
            div.appendChild(input);

            return div;
        }

        function colorPicker(key, configuration, callback) {

            var change = function(event) {
                callback(key, event.target.value);
            }

            var div = document.createElement('div');
            div.classList.add("control");

            var label = document.createElement('label');
            label.innerHTML = configuration.title;
            div.appendChild(label);

            var input = document.createElement('input');
            input.type = "color";
            input.value = configuration.default;
            input.min = configuration.min;
            input.max = configuration.max;
            if (configuration.step !== undefined) {
                input.step = configuration.step;
            }
            input.classList.add("colorPicker");
            input.addEventListener('change', change);
            input.addEventListener('input', change);
            input.addEventListener('keyup', change);
            div.appendChild(input);

            return div;
        }

        function checkbox(key, configuration, callback) {

            var change = function(event) {
                callback(key, event.target.checked);
            }

            var div = document.createElement('div');
            div.classList.add("control");

            var label = document.createElement('label');
            label.innerHTML = configuration.title;
            div.appendChild(label);

            var input = document.createElement('input');
            input.type = "checkbox";
            input.checked = configuration.default;
            input.addEventListener('change', change);
            input.addEventListener('input', change);
            input.addEventListener('keyup', change);

            div.appendChild(input);

            return div;
        }

        function initialize(title, method, renderer, parameters, defaults) {
            Utilities.onDocumentReady(function() {

                if (parameters === null) {
                    parameters = Pattern.options(method);
                    for (var parameter in parameters) {
                        console.log(parameter);
                        parameters[parameter]['default'] = defaults[parameter];
                    }
                }

                var id = uuidv4();
                var height = 300;
                var options = {}

                var patternsDiv = document.getElementById('patterns');

                var container = document.createElement('div');
                container.id = id;
                container.classList.add('pattern-container');
                patternsDiv.appendChild(container);

                var canvas = document.createElement('canvas');
                canvas.classList.add('pattern');
                container.appendChild(canvas);

                var popoverDiv = document.createElement('div');
                popoverDiv.classList.add('popover');
                popoverDiv.classList.add('hidden');
                container.appendChild(popoverDiv);

                var header = document.createElement('h2');
                header.innerHTML = title;
                popoverDiv.appendChild(header);

                var optionDiv = document.createElement('div');
                optionDiv.classList.add('content');
                popoverDiv.appendChild(optionDiv);

                var pre = document.createElement('pre');
                var code = document.createElement('code');
                pre.appendChild(code);

                var updateSource = function(options) {
                    code.innerHTML = "Pattern.render(canvas, \"" + method + "\", " + JSON.stringify(options, null, 4) + ");";
                    hljs.highlightBlock(code);
                };

                if (renderer === null) {
                    renderer = function(canvas, options) {
                        return Pattern.render(canvas, method, options);
                    };
                }

                for (var parameter in parameters) {
                	var settings = parameters[parameter];
                    options[parameter] = settings.default;
                    if (settings.type == "color") {
                    	optionDiv.appendChild(colorPicker(parameter,
                    									  settings,
                    									  function(key, value) {
	                                                          options[key] = value;
	                                                          renderer(canvas, options);
                                                              updateSource(options);
	                                                      }));
                    } else if (settings.type == "boolean") {
                        optionDiv.appendChild(checkbox(parameter,
	                                                   settings,
	                                                   function(key, value) {
	                                                       options[key] = value;
	                                                       renderer(canvas, options);
                                                           updateSource(options);
	                                                   }));
                    } else {
	                    optionDiv.appendChild(slider(parameter,
	                                                 settings,
	                                                 function(key, value) {
	                                                     options[key] = value;
	                                                     renderer(canvas, options);
                                                         updateSource(options);
	                                                 }));
	                }
                }

                container.appendChild(pre);
                popoverDiv.appendChild(pre);

                var buttonDiv = document.createElement('div');
                buttonDiv.classList.add('content');
                buttonDiv.classList.add('meta');
                popoverDiv.appendChild(buttonDiv);

                var rendererWithOptions = function(canvas) {
                    return renderer(canvas, options);
                }

                var desktopSize = Math.max(window.screen.width * window.devicePixelRatio,
                                           window.screen.height * window.devicePixelRatio);

                buttonDiv.appendChild(Utilities.downloadButton(id,
                                                               desktopSize,
                                                               desktopSize,
                                                               "Download Desktop",
                                                               rendererWithOptions));
                buttonDiv.appendChild(Utilities.downloadButton(id,
                                                               600 * window.devicePixelRatio,
                                                               400 * window.devicePixelRatio,
                                                               "Download Sample",
                                                               rendererWithOptions));

                buttonDiv.appendChild(Utilities.button("Download SVG", function(event) {
                    var canvas = document.createElement('canvas');
                    canvas.width = 600;
                    canvas.height = 400;
                    var svg = rendererWithOptions(canvas);
                    Utilities.performDownload(id + '_' + 600 + 'x' + 400 + '.svg', svg.toDataURL());
                }));

                renderer(canvas, options);
                var resize = onResize(canvas, function(canvas, parentWidth, parentHeight) {
                    canvas.width = parentWidth * window.devicePixelRatio;
                    canvas.height = height * window.devicePixelRatio;
                    canvas.style.width = parentWidth + 'px';
                    canvas.style.height = height + 'px';
                    renderer(canvas, options);
                });

                updateSource(options);

                canvas.addEventListener("click", function() {
                    container.classList.toggle('fill');
                    popoverDiv.classList.toggle('hidden');
                    resize();
                    self.location.href = '#' + id;
                });
            });
        }

    </script>
</head>
<body>

<div id="patterns" class="patterns"></div>
<p class="copyright">
    Copyright &copy; Jason Barrie Morley 2019-2020
</p>
<p class="thanks">
    With thanks to Clark Bernier, Michael Dales, Pavlos Vinieratos.
</p>
<script src="pattern.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">

    initialize('Hexagons and Lines', 'other', function(canvas, options) {
    	options.lineDrawer = Pattern.drawers.line(options.lineWidth);
        return Pattern.render(canvas, "other", options);
    }, {lineWidth: {title: 'Line Width', default: 1, min: 1, max: 20},
        size: {title: 'Size', default: 130, min: 1, max: 200},
        spacing: {title: 'Spacing', default: 100, min: 0, max: 200},
	    backgroundColor: {title: 'Background Color', default: '#00a3d8', type: 'color'},
	    foregroundColor: {title: 'Foreground Color', default: '#004d65', type: 'color'}});

    initialize('Asanoha', 'asanoha', function(canvas, options) {
    	options.lineDrawer = Pattern.drawers.line(options.lineWidth);
        return Pattern.render(canvas, "asanoha", options);
    }, {lineWidth: {title: 'Line Width', default: 2, min: 1, max: 20},
        size: {title: 'Size', default: 100, min: 1, max: 200},
	    backgroundColor: {title: 'Background Color', default: '#000033', type: 'color'},
	    foregroundColor: {title: 'Foreground Color', default: '#ffffff', type: 'color'}});

    initialize('Asanoha', 'asanoha', function(canvas, options) {
    	options.lineDrawer = Pattern.drawers.dottedLine(2, 8);
        return Pattern.render(canvas, "asanoha", options);
    }, {size: {title: 'Size', default: 100, min: 1, max: 200},
	    backgroundColor: {title: 'Background Color', default: '#3B0B17', type: 'color'},
	    foregroundColor: {title: 'Foreground Color', default: '#ffffff', type: 'color'}});

    initialize('Shippou', 'shippou', null, {
        lineWidth: {title: 'Line Width', default: 2, min: 1, max: 20},
        radius: {title: 'Radius', default: 40, min: 1, max: 100},
	    backgroundColor: {title: 'Background Color', default: '#330066', type: 'color'},
	    foregroundColor: {title: 'Foreground Color', default: '#ffffff', type: 'color'}});

    initialize('Seigaha', 'seigaiha', null, {
        lineWidth: {title: 'Line Width', default: 2, min: 1, max: 20},
        count: {title: 'Line Count', default: 5, min: 2, max: 20},
        lineSpacing: {title: 'Line Spacing', default: 10, min: 1, max: 20},
        radius: {title: 'Radius', default: 55, min: 1, max: 200},
	    backgroundColor: {title: 'Background Color', default: '#000000', type: 'color'},
	    foregroundColor: {title: 'Foreground Color', default: '#ffffff', type: 'color'},
        alternating: {title: 'Alternate', default: false, type: 'boolean'}});

    initialize('Seigaha', 'seigaiha', null, {
        lineWidth: {title: 'Line Width', default: 1, min: 1, max: 20},
        count: {title: 'Line Count', default: 10, min: 2, max: 20},
        lineSpacing: {title: 'Line Spacing', default: 6, min: 1, max: 20},
        radius: {title: 'Radius', default: 44, min: 1, max: 200},
	    backgroundColor: {title: 'Background Color', default: '#ffffff', type: 'color'},
	    foregroundColor: {title: 'Foreground Color', default: '#0033cc', type: 'color'},
        alternating: {title: 'Alternate', default: false, type: 'boolean'}});

    initialize('Seigaha', 'seigaiha', null, {
        lineWidth: {title: 'Line Width', default: 1, min: 1, max: 20},
        count: {title: 'Line Count', default: 5, min: 2, max: 20},
        lineSpacing: {title: 'Line Spacing', default: 8, min: 1, max: 20},
        radius: {title: 'Radius', default: 44, min: 1, max: 200},
	    backgroundColor: {title: 'Background Color', default: '#19334d', type: 'color'},
	    foregroundColor: {title: 'Foreground Color', default: '#336699', type: 'color'},
        alternating: {title: 'Alternate', default: true, type: 'boolean'}});

    initialize('Sayagata', 'sayagata', null, {
        lineWidth: {title: 'Line Width', default: 1, min: 1, max: 10},
        featureLength: {title: 'Feature Length', default: 9, min: 1, max: 75},
	    angle: {title: 'Angle', default: Math.PI / 2.5, min: Math.PI / 30, max: Math.PI / 2, step: Math.PI / 60},
	    backgroundColor: {title: 'Background Color', default: '#4f2c64', type: 'color'},
	    foregroundColor: {title: 'Foreground Color', default: '#beafe6', type: 'color'}});

    initialize('Stars', 'stars', null, {
        featureLength: {title: 'Feature Length', default: 20, min: 1, max: 100},
        ratio: {title: 'Ratio', default: 66, min: 0, max: 100},
        backgroundColor: {title: 'Background Color', default: '#f0ead6', type: 'color'},
	    foregroundColor: {title: 'Foreground Color', default: '#2e2c29', type: 'color'}});

    initialize('Triangles', 'triangles', null, {
        featureLength: {title: 'Feature Length', default: 26, min: 1, max: 100},
        spacing: {title: 'Spacing', default: 2, min: 1, max: 20},
        backgroundColor: {title: 'Background Color', default: '#ebebeb', type: 'color'},
	    foregroundColor: {title: 'Foreground Color', default: '#ffffff', type: 'color'}});

    initialize('Gosper Curve', 'gosper', null, {
        featureLength: {title: 'Feature Length', default: 9, min: 4, max: 100},
        lineWidth: {title: 'Line Width', default: 1, min: 1, max: 20},
        backgroundColor: {title: 'Background Color', default: '#e4ef65', type: 'color'},
        foregroundColor: {title: 'Foreground Color', default: '#9aa60d', type: 'color'}});

    initialize('Tiles', 'tiles', null, null, {
        angle: (Math.PI / 60) * 11,
        lineWidth: 1,
        backgroundColor: '#1a0952',
        foregroundColor: '#ffffff',
        horizontalLength: 40,
        verticalLength: 30,
        alternate: true});

    initialize('Tiles', 'tiles', null, null, {
        angle: (Math.PI / 60) * 11,
        lineWidth: 1,
        backgroundColor: '#ffffff',
        foregroundColor: '#000000',
        horizontalLength: 40,
        verticalLength: 30,
        alternate: false,
    });

    initialize('Tiles', 'tiles', null, null, {
        "angle": 0.261799387799149,
        "lineWidth": 1,
        "backgroundColor": "#ffffff",
        "foregroundColor": "#000000",
        "horizontalLength": 40,
        "verticalLength": 2,
        "alternate": false,
    });

    initialize('Dots', 'dots', null, null, {
        radius: 12,
        spacing: 6,
        backgroundColor: '#e63b7a',
        foregroundColor: '#ffffff',
        alternate: true,
    });

</script>

</body>
</html>
